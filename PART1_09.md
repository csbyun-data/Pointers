## 1.9 ë™ì  ë©”ëª¨ë¦¬ í• ë‹¹ê³¼ í•´ì œ
* C ì–¸ì–´ëŠ” ì •ì  ë©”ëª¨ë¦¬(static memory) ì™¸ì—ë„ ë™ì  ë©”ëª¨ë¦¬(dynamic memory) ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ì–‘í•œ í•¨ìˆ˜ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.
* ì´ ê¸°ëŠ¥ì„ í†µí•´ ì‹¤í–‰ ì¤‘ í•„ìš”í•œ ë§Œí¼ ë©”ëª¨ë¦¬ë¥¼ í™•ë³´í•˜ê±°ë‚˜ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1.9.1 malloc(), calloc(), realloc(), free ê°œìš”  
âœ… malloc()
* ì›í•˜ëŠ” ë°”ì´íŠ¸ í¬ê¸°ì˜ ë©”ëª¨ë¦¬ ê³µê°„ì„ í™ ì˜ì—­ì— í• ë‹¹.
* ë°˜í™˜ íƒ€ì…ì€ void*ì´ë©°, ì‚¬ìš© ì‹œ í˜•ë³€í™˜ í•„ìš”.
```c
int *arr = (int *)malloc(sizeof(int) * 5);
```

âœ… calloc()
* mallocê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, ì´ˆê¸°í™”ë¥¼ 0ìœ¼ë¡œ ìë™ ìˆ˜í–‰.
```c
int *arr = (int *)calloc(5, sizeof(int));  // 5ê°œì˜ int ê³µê°„ 0ìœ¼ë¡œ ì´ˆê¸°í™”
```

âœ… realloc()
* ê¸°ì¡´ì— í• ë‹¹í•œ ë©”ëª¨ë¦¬ ê³µê°„ì˜ í¬ê¸°ë¥¼ í™•ì¥í•˜ê±°ë‚˜ ì¶•ì†Œ.
* ê¸°ì¡´ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë©´ì„œ ìƒˆ ê³µê°„ìœ¼ë¡œ ë³µì‚¬í•¨.
```c
arr = (int *)realloc(arr, sizeof(int) * 10);
```

âœ… free()
* mallocì´ë‚˜ callocìœ¼ë¡œ í• ë‹¹í•œ ë©”ëª¨ë¦¬ë¥¼ í•´ì œ.
* free(arr);

ğŸ” ë©”ëª¨ë¦¬ í• ë‹¹ í›„ ë°˜ë“œì‹œ ì²´í¬í•  ê²ƒ!
```c
int *ptr = (int *)malloc(sizeof(int) * 10);
if (ptr == NULL) {
    printf("ë©”ëª¨ë¦¬ í• ë‹¹ ì‹¤íŒ¨\n");
    exit(1);
}
```

ì˜ˆì œ 1: Nê°œì˜ ì •ìˆ˜ë¥¼ ì…ë ¥ë°›ì•„ í‰ê·  ê³„ì‚°í•˜ê¸°
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
  int N;
  printf("ì •ìˆ˜ì˜ ê°œìˆ˜ N ì…ë ¥: ");
  scanf("%d", &N);
  
  int *arr = (int *)malloc(sizeof(int) * N);
  if (!arr) {
    printf("ë©”ëª¨ë¦¬ í• ë‹¹ ì‹¤íŒ¨\n");
    return 1;
  }
  
  printf("%dê°œì˜ ì •ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”:\n", N);
  for (int i = 0; i < N; i++) {
    scanf("%d", &arr[i]);
  }
  
  int sum = 0;
  for (int i = 0; i < N; i++) {
    sum += arr[i];
  }
  
  double avg = (double)sum / N;
  printf("í‰ê· : %.2f\n", avg);
  
  free(arr);
  return 0;
}

```

ì˜ˆì œ 2: callocì„ ì‚¬ìš©í•˜ì—¬ ì´ˆê¸°í™” ìƒíƒœ í™•ì¸
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
  int *arr = (int *)calloc(5, sizeof(int));
  if (!arr) return 1;

  for (int i = 0; i < 5; i++) {
      printf("%d ", arr[i]);  // ëª¨ë‘ 0ìœ¼ë¡œ ì¶œë ¥
  }

  free(arr);
  return 0;
}
```

ì˜ˆì œ 3: reallocì„ ì‚¬ìš©í•˜ì—¬ ë°°ì—´ í™•ì¥
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
  int *arr = (int *)malloc(sizeof(int) * 3);
  if (!arr) return 1;

  for (int i = 0; i < 3; i++) arr[i] = i + 1;

  arr = (int *)realloc(arr, sizeof(int) * 5);
  if (!arr) return 1;

  arr[3] = 4;
  arr[4] = 5;

  for (int i = 0; i < 5; i++) {
    printf("%d ", arr[i]);
  }

  free(arr);
  return 0;
}
```

âš ï¸ ë©”ëª¨ë¦¬ í• ë‹¹ ì‹œ ì£¼ì˜ì‚¬í•­
| ë¬¸ì œ                  | ì„¤ëª…                                |
| ------------------- | --------------------------------- |
| ë©”ëª¨ë¦¬ í• ë‹¹ í›„ NULL ì²´í¬ ëˆ„ë½ | ì‹œìŠ¤í…œì´ ë©”ëª¨ë¦¬ ë¶€ì¡±í•  ê²½ìš° í• ë‹¹ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ       |
| í•´ì œ ëˆ„ë½               | `free()` í˜¸ì¶œì„ ìŠìœ¼ë©´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ        |
| í•´ì œ í›„ í¬ì¸í„° ì‚¬ìš©         | í•´ì œ í›„ ì‚¬ìš©ì€ `dangling pointer` ì˜¤ë¥˜ ë°œìƒ |
| ì´ì¤‘ í•´ì œ               | ê°™ì€ í¬ì¸í„°ë¥¼ ë‘ ë²ˆ `free()` í•˜ë©´ ì˜¤ë¥˜ ë°œìƒ     |
| ì˜ëª»ëœ í¬ê¸° ê³„ì‚°           | êµ¬ì¡°ì²´ë‚˜ í¬ì¸í„° í¬ê¸° í˜¼ë™ ì£¼ì˜                 |

### 1.9.2 ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€ í”„ë¡œê·¸ë¨ (Valgrind ì‚¬ìš© ì˜ˆì‹œ)
ì˜ˆì œ 4: ì˜ëª»ëœ ë©”ëª¨ë¦¬ í• ë‹¹
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *arr;
    // scanf("%d", arr);  // âŒ arrì´ ë©”ëª¨ë¦¬ í• ë‹¹ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ ë°œìƒ

    arr = (int *)malloc(sizeof(int));
    if (!arr) return 1;

    scanf("%d", arr);  // âœ… ì˜¬ë°”ë¥¸ í• ë‹¹ í›„ ì…ë ¥
    printf("ì…ë ¥í•œ ê°’: %d\n", *arr);

    free(arr);
    return 0;
}
```

```c
#include <stdio.h>
#include <stdlib.h>

void leak_example() {
  int *data = (int *)malloc(sizeof(int) * 10);
  if (!data) return;

  for (int i = 0; i < 10; i++) {
    data[i] = i;
  }

  // ì˜ë„ì  ëˆ„ìˆ˜: free(data); ë¥¼ í•˜ì§€ ì•ŠìŒ
}

int main() {
  leak_example();
  printf("ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì˜ˆì œ ì‹¤í–‰ ì™„ë£Œ\n");
  return 0;
}
```
* Valgrind ì‚¬ìš© ë°©ë²• (Linux/macOS)
```bash
gcc -g leak.c -o leak
valgrind --leak-check=full ./leak
```
* Valgrind ê²°ê³¼ ì˜ˆì‹œ:
```php
==12345== 40 bytes in 1 blocks are definitely lost in loss record 1 of 1
==12345==    at 0x4C2BBAF: malloc (vg_replace_malloc.c:xxx)
==12345==    by 0x4011F6: leak_example (leak.c:5)
==12345==    by 0x40122A: main (leak.c:13)
```
* ìˆ˜ì • í›„
```
free(data);  // ëˆ„ìˆ˜ ë°©ì§€
```

ğŸ“š ì •ë¦¬ ìš”ì•½
| ë¬¸ì œ        | ì‚¬ìš© í•¨ìˆ˜                        | í•µì‹¬ ê¸°ëŠ¥            | ì£¼ì˜ì‚¬í•­                   |
| --------- | ---------------------------- | ---------------- | ---------------------- |
| Nê°œ í‰ê·  ê³„ì‚°  | `malloc`, `free`             | ì…ë ¥ í¬ê¸°ë§Œí¼ ë™ì  ë°°ì—´ ìƒì„± | í‰ê·  ê³„ì‚° ì‹œ `(double)` ì‚¬ìš©  |
| ë°°ì—´ í™•ì¥ ì…ë ¥  | `realloc`                    | ê¸°ì¡´ ë°°ì—´ì„ 2ë°° í™•ì¥     | ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ë©”ëª¨ë¦¬ í•´ì œ í•„ìš”      |
| ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì ê²€ | `valgrind`, `malloc`, `free` | ëˆ„ìˆ˜ ì‹œê°í™” ë„êµ¬ í™œìš©     | ë””ë²„ê¹… í•„ìˆ˜, `free()` ëˆ„ë½ ê¸ˆì§€ |

âœ… ì—°ìŠµ ë¬¸ì œ

1. ì‚¬ìš©ìë¡œë¶€í„° ì •ìˆ˜ Nì„ ì…ë ¥ë°›ê³ , Nê°œì˜ ì •ìˆ˜ë¥¼ ì…ë ¥ë°›ì•„ í‰ê· ì„ ê³„ì‚°í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ë³´ì„¸ìš”.

2. reallocì„ ì´ìš©í•´ 5ê°œì˜ ì •ìˆ˜ë¥¼ ì…ë ¥ë°›ê³ , ë°°ì—´ì„ 10ê°œë¡œ í™•ì¥í•´ ë‹¤ì‹œ ì…ë ¥ë°›ì•„ ì „ì²´ ì¶œë ¥í•´ë³´ì„¸ìš”.

3. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ê°ì§€í•˜ê¸° ìœ„í•œ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ë³´ê³ , valgrindì™€ ê°™ì€ ë„êµ¬ë¡œ ì ê²€í•´ë³´ì„¸ìš”.
