π”Ή 4.3 μ΄μ¤‘ ν•΄μ  λ¬Έμ  (Double Free)
β… κ°μ”

delete λλ” freeλ¥Ό ν†µν•΄ ν•΄μ λ λ©”λ¨λ¦¬λ¥Ό
ν• λ² λ” ν•΄μ ν•λ ¤κ³  μ‹λ„ν•  κ²½μ° λ°μƒν•λ” μ¤λ¥μ…λ‹λ‹¤.

μ΄μ¤‘ ν•΄μ λ” C/C++μ—μ„ λ§¤μ° μΉλ…μ μΈ **μ •μλμ§€ μ•μ€ λ™μ‘(UB)**μ„ μ λ°ν•©λ‹λ‹¤.

β… μμ‹: μ΄μ¤‘ ν•΄μ  λ°μƒ
int* ptr = new int(10);
delete ptr;
delete ptr;  // β μ΄μ¤‘ ν•΄μ  β†’ μ •μλμ§€ μ•μ€ λ™μ‘

κ²°κ³Ό:

ν¬λμ‹

μ΄μƒ λ™μ‘

ν•΄μ»¤μ—κ² κ³µκ²© μ§€μ  μ κ³µ (heap overflow μ•…μ© κ°€λ¥)

β… μ™ μ„ν—ν•κ°€?

λ©”λ¨λ¦¬ ν• λ‹Ή λΌμ΄λΈλ¬λ¦¬λ” λ‚΄λ¶€μ μΌλ΅ **ν”„λ¦¬ λ¦¬μ¤νΈ(free list)**λ¥Ό κ΄€λ¦¬ν•¨

μ΄μ¤‘ ν•΄μ λ΅ μΈν•΄ μ΄λ―Έ ν•΄μ λ λ©”λ¨λ¦¬ μμ—­μ΄ λ‹¤μ‹ ν•΄μ λλ©΄μ„,
ν™ κµ¬μ΅°κ°€ μ†μƒλ¨ (heap corruption)

β… μ•μ „ν• μ½”λ“ ν¨ν„΄: nullptrλ΅ μ΄κΈ°ν™”
int* ptr = new int(20);
delete ptr;
ptr = nullptr;  // μ΄ν›„ deleteν•΄λ„ μ•μ „

delete ptr;  // β… μ•„λ¬΄ μΌλ„ μΌμ–΄λ‚μ§€ μ•μ (nullptrλ” μ•μ „)

delete nullptr;λ” ν‘μ¤€μ μΌλ΅ ν—μ©λ¨
int* p = nullptr;
delete p;  // β… OK

β… μ‹¤μ μ ν• μ
β μ 1: λ‘ ν¬μΈν„°κ°€ κ°™μ€ λ©”λ¨λ¦¬λ¥Ό κ°€λ¦¬ν‚¬ λ•
int* a = new int(5);
int* b = a;

delete a;
delete b;  // β μ΄μ¤‘ ν•΄μ 

β… ν•΄κ²°: ν•λ‚λ§ μ†μ ν•κ±°λ‚ μ¤λ§νΈ ν¬μΈν„° μ‚¬μ©
β… ν•΄κ²° λ°©λ²•
μƒν™©	ν•΄κ²° λ°©μ•
ν¬μΈν„° ν•΄μ  ν›„ μ‚¬μ© κΈμ§€	nullptrλ΅ μ΄κΈ°ν™”
μ—¬λ¬ ν¬μΈν„°κ°€ ν•λ‚λ¥Ό κ°€λ¦¬ν‚΄	μ¤λ§νΈ ν¬μΈν„° (shared_ptr, unique_ptr) μ‚¬μ©
λ³µμ‚¬ λ°©μ§€ ν•„μ” μ‹	μ†μ κ¶ μ΄μ „(move semantics) μ μ©
β… μ¤λ§νΈ ν¬μΈν„°λ΅ μ•μ „ν•κ²
#include <memory>

void example() {
    std::shared_ptr<int> sp1 = std::make_shared<int>(42);
    std::shared_ptr<int> sp2 = sp1;  // μ°Έμ΅° μΉ΄μ΄νΈ μ¦κ°€

    // μλ™μΌλ΅ μ°Έμ΅° μΉ΄μ΄νΈ κ΄€λ¦¬ β†’ double free λ°©μ§€
}


μ¤λ§νΈ ν¬μΈν„°λ” μ΄μ¤‘ ν•΄μ λ¥Ό μλ™μΌλ΅ λ°©μ§€ν•΄ μ¤λ‹λ‹¤.

π“ μ”μ•½
ν•­λ©	μ„¤λ…
μ΄μ¤‘ ν•΄μ λ€?	κ°™μ€ ν¬μΈν„°λ¥Ό λ‘ λ² μ΄μƒ deleteν•κ±°λ‚ freeν•λ” κ²ƒ
κ²°κ³Ό	ν”„λ΅κ·Έλ¨ ν¬λμ‹, ν™ μ†μƒ, λ³΄μ• λ¬Έμ 
λ°©μ§€λ²•	delete ν›„ nullptr λ€μ…, μ†μ κ¶ λ…ν™•ν κµ¬λ¶„, μ¤λ§νΈ ν¬μΈν„° μ‚¬μ©
ν	delete nullptrλ” μ•μ „ν•λ―€λ΅ μ΄κΈ°ν™” μµκ΄€ν™” ν•„μ”
